This module builds a data pipeline using the `pokeapi.co <https://pokeapi.co/>`_ REST API.

Pokemon API Pipeline
====================

This pipeline demonstrates loading data from a public REST API into a PostgreSQL database using `dlt`. It fetches a list of Pokemon and then retrieves detailed information for each one.

Pipeline Components
-------------------

- **Data Source**: `pokeapi.co <https://pokeapi.co/>`_ REST API.
- **ETL Tool**: ``dlt`` (data load tool) Python library.
- **Destination**: A PostgreSQL database instance.

Workflow
--------

The pipeline executes the following steps:

1.  **Initialization**: A ``dlt`` pipeline is initialized with the name ``pokemon_api_pipeline``, a ``postgres`` destination, and the dataset name ``pokemon_data``.
2.  **Fetch Pokemon List**: The ``fetch_pokemon_data`` resource is called to get an initial list of Pokemon from the API endpoint ``/api/v2/pokemon``.
3.  **Fetch Pokemon Details**: The ``pokemon_details`` transformer takes the list of Pokemon and, for each one, calls its respective URL to get detailed information.
4.  **Table Creation**: ``dlt`` creates a main table ``pokemon_api_details`` in the ``pokemon_data`` schema. It also creates other tables for nested data structures within the API response.
5.  **Data Insertion**: The data from the API is inserted into the corresponding tables.
6.  **Termination**: The pipeline run finishes, and load information is printed to the console.

Workflow Diagram
~~~~~~~~~~~~~~~~

.. mermaid::
   :name: pokemon_pipeline_workflow

   graph TD
    A[Start] --> B{Initialize dlt Pipeline};
    B --> C{Run pipeline with pokemon_details};
    C --> D[fetch_pokemon_data resource];
    D --> E[pokeAPI /pokemon];
    E --> F[pokemon_details transformer];
    F --> G["pokeAPI /pokemon/{id}"];
    G --> H["PostgreSQL (pokemon_data schema)"];
    H --> I[End];

The pipeline creates a main table ``pokemon_api_details`` in the ``pokemon_data`` schema. Since the API response for a single Pokemon contains nested JSON objects and arrays, ``dlt`` automatically creates additional tables to store this nested data. 

The main table contains top-level information about the Pokemon, and other tables are created for properties like:

- ``abilities``
- ``forms``
- ``game_indices``
- ``held_items``
- ``moves``
- ``past_types``
- ``stats``
- ``types``

The columns in each table are inferred by ``dlt`` from the keys in the JSON response. ``dlt`` also adds its own metadata columns (``_dlt_load_id``, ``_dlt_id``) for internal tracking.

Technical Documentation
-----------------------

.. note:: Following section is auto-generated by `sphinx-autodoc-typehints` extension.

Entry point for the Pokemon API pipeline:

.. automodule:: pokemon_pipeline
   :members:

The ``pokemon_pipeline`` has the following resources and transformers:

.. autofunction:: pokemon_pipeline.fetch_pokemon_data
.. autofunction:: pokemon_pipeline.pokemon_details


.. admonition:: Laugh Time!
   :class: laughter

   What is Pikachu's favorite candy? Shock~tarts! ü•Å

